# ğŸš€ **FastAPI (2) â€” ì‹¬í™” ë° í™•ì¥ ê¸°ëŠ¥**

## **1. Pydantic ì‚¬ìš©ë²•**

### ğŸ”¹ 1.1 Pydantic ì†Œê°œ & ê¸°ëŠ¥
- **Pydantic**ì€ FastAPIì˜ í•µì‹¬ ë°ì´í„° ëª¨ë¸ ê²€ì¦ ë„êµ¬ë¡œ,  
  íƒ€ì… íŒíŠ¸ë¥¼ **ëŸ°íƒ€ì„ì—ì„œ ê°•ì œ**í•˜ì—¬ ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
- ì£¼ìš” íŠ¹ì§•:
  - Python ê¸°ë³¸ íƒ€ì… (`str`, `int`, `float`, `bool` ë“±) + `List`, `Dict`, `Tuple` ê²€ì¦ ê°€ëŠ¥  
  - ê¸°ì¡´ Validation ë¼ì´ë¸ŒëŸ¬ë¦¬ë³´ë‹¤ ë¹ ë¥¸ ì„±ëŠ¥ (Benchmark í™•ì¸ë¨)
  - **ML Feature ë°ì´í„° ê²€ì¦**ì—ë„ í™œìš© ê°€ëŠ¥  
    ì˜ˆ) Feature AëŠ” `int`, ê°’ ë²”ìœ„ëŠ” 0~100 ì‚¬ì´ ë“±

---

### ğŸ”¹ 1.2 Validation

#### âœ… ê²€ì¦ ì‚¬ë¡€
- ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ì…ë ¥ê°’ ê²€ì¦
- Online Servingì—ì„œ Request ë°ì´í„° Validation

**ê²€ì¦ ì¡°ê±´ ì˜ˆì‹œ**
1. ì˜¬ë°”ë¥¸ URL ì…ë ¥ (`url`)
2. 1~10 ì‚¬ì´ì˜ ì •ìˆ˜ (`rate`)
3. ìœ íš¨í•œ ë””ë ‰í† ë¦¬ ê²½ë¡œ (`target_dir`)

#### ğŸ§© Validation ë°©ë²• ë¹„êµ
| ë°©ë²• | ì„¤ëª… | ë‹¨ì  |
|------|------|------|
| ì¼ë°˜ Python Class | ì§ì ‘ ê²€ì¦ ë¡œì§ ì‘ì„± | ì½”ë“œå†—é•·, ì˜ˆì™¸ ì²˜ë¦¬ ë³µì¡ |
| Dataclass | `__post_init__`ë¡œ ìƒì„± ì‹œì  Validation | ì—¬ì „íˆ ìˆ˜ë™ ê²€ì¦ í•„ìš” |
| Pydantic | ìƒì„± ì‹œì  ìë™ Validation | ì½”ë“œ 6ì¤„ ë‚´ì™¸ë¡œ ê°„ê²°, íƒ€ì… ê¸°ë°˜ ì—ëŸ¬ ë°œìƒ |

#### ğŸ’¡ Pydanticì˜ ì¥ì 
- Validation ë° Config ê¸°ëŠ¥ì„ í•˜ë‚˜ì˜ ëª¨ë¸ë¡œ ê´€ë¦¬ ê°€ëŠ¥  
- HTTP URL, DB URL, Enum ë“± ê¸°ë³¸ ì œê³µ íƒ€ì… ì™¸ì—ë„ **Custom Type** ì‰½ê²Œ ì •ì˜ ê°€ëŠ¥  
- ì—ëŸ¬ ë°œìƒ ì‹œ **ìœ„ì¹˜, íƒ€ì…, ë©”ì‹œì§€**ë¥¼ ìƒì„¸íˆ ë°˜í™˜  
- ì°¸ê³ : [Pydantic ê³µì‹ ë¬¸ì„œ](https://docs.pydantic.dev/latest/concepts/types/)

---

### ğŸ”¹ 1.3 Config ê´€ë¦¬

#### âš™ï¸ Config ì •ì˜
- ì•± ì‹¤í–‰ì— í•„ìš”í•œ **í™˜ê²½ ì„¤ì • ì •ë³´ (ì˜ˆ: DB ì—°ê²°, API í‚¤ ë“±)**  
- í•œ ê³³ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„± í•„ìš”

#### ğŸ“¦ Config ê´€ë¦¬ ë°©ë²•
| ë°©ë²• | íŠ¹ì§• | ë‹¨ì  |
|------|------|------|
| ì½”ë“œ ë‚´ ìƒìˆ˜ë¡œ ê´€ë¦¬ | ê°€ì¥ ë‹¨ìˆœ | ë³´ì•ˆ ë…¸ì¶œ ìœ„í—˜, í™˜ê²½ ë¶„ë¦¬ ì–´ë ¤ì›€ |
| YAML ë“± ì™¸ë¶€ íŒŒì¼ ê´€ë¦¬ | í™˜ê²½ë³„ íŒŒì¼ ë¶„ë¦¬ (dev/prod ë“±) | ì—¬ì „íˆ íŒŒì¼ ë…¸ì¶œ ìœ„í—˜ ì¡´ì¬ |
| í™˜ê²½ë³€ìˆ˜ + `Pydantic.BaseSettings` | íƒ€ì… ê¸°ë°˜ ê²€ì¦ + `.env` í™œìš© | ì‹¤ë¬´ ì¶”ì²œ ë°©ì‹ |

> âœ… **ì¶”ì²œ:**  
> FastAPI ì‚¬ìš© ì‹œ `Pydantic.BaseSettings`ë¥¼ í™œìš©í•˜ì—¬ Config ê´€ë¦¬  
> â†’ ë³´ì•ˆ ì •ë³´ ë…¸ì¶œ ë°©ì§€ + í™˜ê²½ë³„ ìœ ì—°í•œ ì„¤ì • ê°€ëŠ¥

---

## **2. FastAPI í™•ì¥ ê¸°ëŠ¥**

### ğŸ”¹ 2.1 Lifespan Function
- FastAPI ì•±ì˜ **ì‹œì‘(Startup)** ê³¼ **ì¢…ë£Œ(Shutdown)** ì‹œ ì‹¤í–‰ë˜ëŠ” ë¡œì§ì„ ì •ì˜
- ì˜ˆ)  
  - ì‹œì‘ ì‹œ ëª¨ë¸ ë¡œë“œ  
  - ì¢…ë£Œ ì‹œ DB ì—°ê²° ì¢…ë£Œ
- êµ¬í˜„ ì˜ˆì‹œ:
  ```python
  async def lifespan(app: FastAPI):
      # ì•± ì‹œì‘ ì „
      yield
      # ì•± ì¢…ë£Œ ì „
  app = FastAPI(lifespan=lifespan)
  ```
- ê´€ë ¨ ë¬¸ì„œ: [FastAPI Lifespan Docs](https://fastapi.tiangolo.com/advanced/events/)

---

### ğŸ”¹ 2.2 API Router
- ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ê´€ë¦¬ ì–´ë ¤ì›€ â†’ **Router ë¶„ë¦¬**
- `APIRouter`ë¥¼ í™œìš©í•˜ë©´ ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ê´€ë¦¬ ê°€ëŠ¥
  ```python
  router = APIRouter()
  @router.get("/users/{id}")
  def get_user(id: int):
      ...
  app.include_router(router)
  ```
- ì¼ë°˜ì ìœ¼ë¡œ `routers/` í´ë” ì•„ë˜ì— APIë³„ íŒŒì¼ ìƒì„±  
  (ì˜ˆ: `user.py`, `order.py`)

---

### ğŸ”¹ 2.3 Project Structure (í”„ë¡œì íŠ¸ êµ¬ì¡°)
> ê·œëª¨ê°€ ì»¤ì§ˆìˆ˜ë¡ êµ¬ì¡°í™”ê°€ í•„ìˆ˜!

**ì˜ˆì‹œ êµ¬ì¡°**
```
app/
 â”œâ”€â”€ __init__.py
 â”œâ”€â”€ main.py            # ë©”ì¸ ì‹¤í–‰ íŒŒì¼
 â”œâ”€â”€ dependencies.py    # ì˜ì¡´ì„± ê´€ë¦¬
 â”œâ”€â”€ routers/
 â”‚   â”œâ”€â”€ __init__.py
 â”‚   â”œâ”€â”€ items.py
 â”‚   â””â”€â”€ users.py
 â””â”€â”€ internal/
     â”œâ”€â”€ __init__.py
     â””â”€â”€ admin.py
```

- `routers` í´ë”: Sub FastAPI ëª¨ë“ˆ  
- `internal`: ë‚´ë¶€ ì „ìš© ê¸°ëŠ¥ (ê´€ë¦¬ì ë“±)

---

### ğŸ”¹ 2.4 Error Handler
- ì„œë²„ ì•ˆì •ì„±ì„ ìœ„í•œ í•„ìˆ˜ ê¸°ëŠ¥
- ê¸°ë³¸ì ìœ¼ë¡œ ì˜ˆì™¸ ë°œìƒ ì‹œ 500 Internal Server Error  
  â†’ í´ë¼ì´ì–¸íŠ¸ëŠ” ì›ì¸ íŒŒì•… ë¶ˆê°€
- **í•´ê²°:** `HTTPException` í™œìš©
  ```python
  from fastapi import HTTPException

  @app.get("/items/{item_id}")
  def read_item(item_id: int):
      if item_id not in items:
          raise HTTPException(status_code=404, detail="Item not found")
  ```
- ì—ëŸ¬ ë°œìƒ ì‹œ ìƒíƒœ ì½”ë“œ + ìƒì„¸ ë©”ì‹œì§€ ë°˜í™˜ ê°€ëŠ¥

---

### ğŸ”¹ 2.5 Background Tasks
- ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ **ë¹„ë™ê¸°(Asynchronous)** ë¡œ ì²˜ë¦¬  
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì¦‰ì‹œ ì‘ë‹µë°›ê³ , ì‘ì—…ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë¨
  ```python
  from fastapi import BackgroundTasks

  def send_email(email: str):
      ...

  @app.post("/send")
  def send(background_tasks: BackgroundTasks, email: str):
      background_tasks.add_task(send_email, email)
      return {"message": "Email sending started"}
  ```
- ì˜ˆì‹œ: ì´ë©”ì¼ ì „ì†¡, ë¡œê·¸ ê¸°ë¡, ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬ ë“±

---

## **3. FastAPIê°€ ì–´ë µë‹¤ë©´**

### ğŸ”¹ 3.1 ì–´ë ¤ìš´ ì´ìœ 
1. í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„ ë¯¸ìˆ™  
2. ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°(OOP) ë¯¸ìˆ™  
3. ë°±ì—”ë“œ ê²½í—˜ ë¶€ì¡±  
4. ëª…í™•í•œ ëª©í‘œ ë¶€ì¬

---

### ğŸ”¹ 3.2 í”„ë¡œì íŠ¸ êµ¬ì¡° - Cookiecutter
- í”„ë¡œì íŠ¸ í…œí”Œë¦¿ ìƒì„± ë„êµ¬  
  - CLI ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ìë™ ìƒì„±  
  - ê³µí†µ êµ¬ì¡°ë¥¼ íŒ€ ë‹¨ìœ„ë¡œ ê³µìœ  ê°€ëŠ¥
- ì¶”ì²œ í…œí”Œë¦¿:
  - [cookiecutter-data-science](https://github.com/drivendata/cookiecutter-data-science)
  - [cookiecutter-fastapi](https://github.com/arthurhenrique/cookiecutter-fastapi)

> âš¡ ì²˜ìŒì—” í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ìµìˆ™í•´ì§„ ë’¤  
> ì ì°¨ êµ¬ì¡°í™” ë° í´ë¦° ì•„í‚¤í…ì²˜ë¡œ í™•ì¥í•  ê²ƒ.

---

### ğŸ”¹ 3.3 ê°ì²´ì§€í–¥
- ì ˆì°¨í˜• vs ê°ì²´ì§€í–¥ ì°¨ì´ë¥¼ ì´í•´  
- ì½”ë“œ ì¬ì‚¬ìš©ì„± í–¥ìƒ ë° ìœ ì§€ë³´ìˆ˜ ìš©ì´
- Pydantic ëª¨ë¸ êµ¬ì¡°ë¥¼ í†µí•´ ìì—°ìŠ¤ëŸ½ê²Œ OOP í•™ìŠµ ê°€ëŠ¥

---

### ğŸ”¹ 3.4 Try & Error
- ë‚¯ì„  ê²ƒì´ ë‹¹ì—°í•˜ë¯€ë¡œ **ì‹¤ìŠµ ì¤‘ì‹¬ í•™ìŠµ** ê¶Œì¥  
  - â€œì‘ì„± â†’ ì‹¤í–‰ â†’ ìˆ˜ì •â€ ë°˜ë³µ  
- ì‘ê²Œ ì‹œì‘í•´ì„œ ì ì§„ì ìœ¼ë¡œ í™•ì¥  
- **ëª…í™•í•œ ëª©í‘œ ì„¤ì •**
  - ì˜ˆ: â€œFastAPIë¡œ ê°„ë‹¨í•œ ì˜ˆì¸¡ API ë§Œë“¤ê¸°â€

---

## âœ… **ì •ë¦¬ ìš”ì•½**

| êµ¬ë¶„ | í•µì‹¬ ë‚´ìš© |
|------|------------|
| **Pydantic** | Validation + Config ê´€ë¦¬, íƒ€ì… ê¸°ë°˜ ì•ˆì „ì„± |
| **Lifespan** | ì•± ì‹œì‘/ì¢…ë£Œ ì‹œ ìë™ ì‹¤í–‰ ë¡œì§ |
| **API Router** | ëª¨ë“ˆ ë‹¨ìœ„ë¡œ API êµ¬ì¡°í™” |
| **Error Handler** | ì˜ˆì™¸ì²˜ë¦¬ ë° ìƒì„¸ ì—ëŸ¬ ì‘ë‹µ |
| **Background Task** | ë¹„ë™ê¸° ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… |
| **Cookiecutter** | í”„ë¡œì íŠ¸ êµ¬ì¡° í…œí”Œë¦¿ |
| **í•™ìŠµ íŒ** | ì‘ê²Œ ì‹œì‘ â†’ êµ¬ì¡°í™” â†’ ë°˜ë³µ ì‹¤ìŠµ |

---

> ğŸ“š ì°¸ê³ : NAVER Connect Foundation â€” *[Product Serving] FastAPI (2)* ê°•ì˜ìë£Œ
